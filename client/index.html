<!DOCTYPE html>
<html ng-app="app">
<head>
    <meta charset="utf-8">
    <title>tagslide</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/emojione/1.1.0/assets/css/emojione.min.css" type="text/css" media="all" />
    <style>
		body {
			font-family: sans-serif;
			overflow:hidden;
			color: #fff;
			background: #000;
		}

		.source {
			display:none;
		}

		.help, .user, .comments, .caption {
			z-index: 10;
			position:absolute;
		}

		.help {
			width: 100%;
			font-size:3em;
			text-align:center;

			color: white;
			text-shadow:
			3px 3px 0 #000,
			-1px -1px 0 #000,  
			1px -1px 0 #000,
			-1px 1px 0 #000,
			1px 1px 0 #000;

			-webkit-text-stroke: 1px black;
			-webkit-text-fill-color: white;
		}

		.caption {
			left: 170px;
			top:  50px;
		}

		.user, .comments, .caption {
			background: black;
			margin: 10px;
			padding:  5px;
			opacity: 0.5;
		}

		.user {
			text-align:center;
			
		}

		.comments {
			right: 0;
			bottom:0;
			max-width: 50%;
		}

		.comment {
			clear:both;
		}

		.comment img {
			vertical-align:middle;
			float:left;
			max-height: 1em;
			max-width:1em;
		}

		.comment .text {
			float:left;
		}

		.post {
			position:absolute;
			top:0;
			left:0;
			width: 100%;
			height: 100%;
		}

		.post.ng-enter {
			animation: fadeIn 1s;
			-webkit-animation: fadeIn 1s;
			-moz-animation: fadeIn 1s;
			-o-animation: fadeIn 1s;
		}

		.post.ng-leave {
			animation: fadeOut 1s;
			-webkit-animation: fadeOut 1s;
			-moz-animation: fadeOut 1s;
			-o-animation: fadeOut 1s;
		}

		.post .media img {
			position: absolute;
			bottom: -50%; 
			right: 0px; 
			min-width: 100%; 
			min-height: 100%; 
			width: auto; 
			height: auto;
			overflow: hidden;
		}

		.post .media video {
			position: absolute;
			bottom: 0px; 
			right: 0px; 
			min-width: 100%; 
			min-height: 100%; 
			width: auto; 
			height: auto; 
			overflow: hidden
		}
    </style>
</head>
<body ng-controller="MainCtrl">
	<div class="help" ng-show="tag" >Post to Instagram with #{{tag}}</div>
	<div class="post" ng-repeat="post in posts">
		<div class="media">
	        <img ng-if="post.type == 'image'" ng-src="{{post.media}}" />
	        <video ng-if="post.type == 'video'" autoplay muted loop ng-src="{{post.media}}"></video>
	    </div>
	    <div class="user">
	        <img ng-src="{{post.user_image}}" />
	        <div class="username">{{post.username}}</div>
	    </div>
	    <div class="source">{{post.source}}</div>
	    <div class="caption" ng-bind-html="post.caption"></div>
	    <div ng-if="post.comments" class="comments">
	    	<div class="comment" ng-repeat="comment in post.comments">
	    		<img class="user" ng-src="{{comment.from.profile_picture}}">
	    		<div class="text" ng-bind-html="comment.text"></div>
	    	</div>
	    </div>
	</div>
</body>

<script src="/socket.io/socket.io.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.0-rc.2/angular.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.0-rc.2/angular-animate.min.js"></script>
<script src="https://cdn.jsdelivr.net/emojione/1.1.0/lib/js/emojione.min.js" type="text/javascript"></script>

<script>
angular.module('app', ['ngAnimate'])
    .controller('MainCtrl', function ($scope, $sce) {
    	$scope.posts = [];
    	io = io.connect();
    	io.emit('ready');
    	io.on('post', function(post) {
		    $scope.posts.shift();
		    post.media = $sce.trustAsResourceUrl(post.media);
		    post.caption = $sce.trustAsHtml(emojione.toImage(post.caption));
		    $scope.posts.push(post);
		    $scope.tag = post.tag;
		    if (post.comments){
		    	post.comments = post.comments.map(function(comment){
		    		comment.text = $sce.trustAsHtml(comment.text); return comment;
		    	});
		    }
		    $scope.$apply();
		});
    });
</script>